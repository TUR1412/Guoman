# 变更提案: 墨韵视觉进化（Visual Settings + UI 体系强化）

## 需求背景

当前项目已具备较完整的“墨韵国风 × Aurora × Glass”视觉基座与较好的工程质量闸门，但仍存在一个核心不足：**视觉风格无法被用户“按偏好调参”**，导致在不同设备/网络环境/敏感人群（视觉敏感、动效敏感）下，体验缺少可控性与个性化。

本次变更目标是将视觉体系从“固定设计”升级为“可控设计”，并在不引入新依赖的前提下，把关键页面的观感、层级与一致性提升到更接近商业化产品的水准。

## 产品分析

### 目标用户与场景

- **用户群体:** 国漫爱好者 / 喜好国风 UI 的用户 / 偏好沉浸式浏览的用户
- **使用场景:**
  - 夜间刷榜、追更（暗色主题为主）
  - 弱网/省流环境下的“可用但不糊”体验
  - 对动效敏感或视觉噪声敏感的用户（需要更少动画、更少噪点、更少 blur）

### 价值主张与成功指标

- **价值主张:** 让“墨韵质感”从单一风格，升级为“用户可控的视觉引擎”，在不牺牲可读性的前提下实现个性化与舒适度。
- **成功指标（可验证）:**
  - 关键页面（首页/列表/详情/用户中心）视觉层级一致、可读性稳定
  - 用户中心新增“视觉设置”可即时生效并持久化
  - 可访问性：键盘可达、焦点样式可见、`prefers-reduced-motion` 与手动“减少动效”均有效
  - 性能：在 `data-low-data` 场景下自动降载（噪点/极光/blur）且不破坏主题一致性

### 人文关怀

- 提供“减少动效/禁用玻璃模糊/降低噪点与极光强度/字体缩放”等能力，降低视觉疲劳与动效不适；
- 所有设置本地保存，不要求登录，不上传隐私数据；
- 默认值维持当前审美基线，避免“调参后不可读”的风险（带合理边界与回退）。

## 变更内容

1. **视觉设置（Visual Settings）**：提供可持久化的视觉参数（噪点/极光/blur/动效/字号），并做到即时生效。
2. **设计变量强化**：将噪点与极光强度收敛为 Design Tokens（CSS Variables），并与 `data-low-data` 规则可叠加而非互相覆盖。
3. **关键页面一致性**：在不推翻现有组件结构的前提下，补齐视觉设置入口与说明文案，保证商业化观感的一致性与可解释性。

## 影响范围

- **模块:**
  - Theme / Visual Tokens（全局 CSS 变量）
  - Local-first Data（localStorage 设置存取 + Data Vault 导入导出）
  - App Shell（动效策略与设置联动）
  - User Center（新增视觉设置 UI）
- **文件:** 以实现变更清单为准（见 task.md）。
- **API:** 无对外 API（纯前端本地能力）。
- **数据:** 新增 1 个本地存储 key（视觉设置），纳入 Data Vault 导入/导出。

## 核心场景

### 需求: 视觉设置可控

**模块:** Theme / Visual Tokens
为用户提供可控的墨韵强度与动效策略，并保证设置即时生效与持久化。

#### 场景: 降低噪点与极光强度

用户在用户中心调低“纸纹噪点/极光光晕”强度后：

- 背景噪点与极光叠层立即变弱
- 刷新页面后仍保留该偏好
- 在 `data-low-data` 下会进一步自动降载（叠乘生效）

#### 场景: 禁用玻璃模糊

用户开启“禁用玻璃模糊”后：

- 全站 `backdrop-filter` 失效（但边框/阴影仍保持层级）
- 在弱网/省流模式下亦保持一致（不冲突）

#### 场景: 强制减少动效

用户开启“减少动效”后：

- Framer Motion 进入强制 reduced 模式（等价于 `prefers-reduced-motion`）
- CSS 动效（shimmer/过渡）也进入低动效策略

#### 场景: 字号缩放

用户调整字号缩放后：

- 全站字体大小按比例变化
- 不破坏布局（控制缩放边界，避免过大导致溢出）

## 风险评估

- **风险:** 过度个性化导致可读性下降
  - **缓解:** 设定可控范围（min/max），提供“一键恢复默认”
- **风险:** `backdrop-filter` 关闭后部分页面层级变弱
  - **缓解:** 保留边框/阴影层级，确保卡片仍可区分
- **风险:** 设置导入/导出格式变更导致兼容性问题
  - **缓解:** schemaVersion + 容错解析，保留默认回退逻辑
